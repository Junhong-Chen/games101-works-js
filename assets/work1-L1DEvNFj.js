var J=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var l=(i,e,t)=>(J(i,e,"read from private field"),t?t.call(i):e.get(i)),m=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},y=(i,e,t,s)=>(J(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t);var _=(i,e,t,s)=>({set _(o){y(i,e,o,t)},get _(){return l(i,e,s)}}),M=(i,e,t)=>(J(i,e,"access private method"),t);import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as g,c as nt}from"./vec3-DxJeS3HW.js";import{f as rt}from"./vec2-AJwhbUHB.js";import{m as D,c as j,t as O,f as Q,a as U,s as ct,b as at}from"./vec4-DVpAb33O.js";class lt{get a(){return this.v[0]}get b(){return this.v[1]}get c(){return this.v[2]}constructor(){this.v=[],this.color=[],this.textureCoords=[],this.normal=[]}setVertex(e,t){this.v[e]=t}setNormal(e,t){this.normal[e]=t}setColor(e,t,s,o){if(t<0||t>255||s<0||s>255||o<0||o>255)throw new Error("Invalid color values");this.color[e]=g(t/255,s/255,o/255)}setTextureCoord(e,t,s){this.textureCoords[e]=rt(t,s)}}var $,A,E,B,q,I,K,P,b,k,C,T,H,et,R,st,L,X;class ht{constructor(){m(this,C);m(this,H);m(this,R);m(this,L);m(this,$,void 0);m(this,A,void 0);m(this,E,void 0);m(this,B,new Map);m(this,q,new Map);m(this,I,[]);m(this,K,[]);m(this,P,void 0);m(this,b,void 0);m(this,k,0)}get framebuffers(){return l(this,I)}rasterizer(e,t){y(this,P,e),y(this,b,t),l(this,I).length=e*t,l(this,K).length=e*t}loadPositions(e){const t=M(this,L,X).call(this);return l(this,B).set(t,e),t}loadIndices(e){const t=M(this,L,X).call(this);return l(this,q).set(t,e),t}setModel(e){y(this,$,e)}setView(e){y(this,A,e)}setProjection(e){y(this,E,e)}setPixel(e,t){const[s,o]=e;if(s>=0&&s<=l(this,P)&&o>=0&&o<=l(this,b)){const f=M(this,R,st).call(this,s,o);l(this,I)[f]=t}}clear(e=!1,t=!1){e&&l(this,I).fill(nt()),t&&l(this,K).fill(1/0)}draw(e,t,s){if(s!=="triangle")throw new Error("Drawing primitives other than triangle is not implemented yet!");const o=l(this,B).get(e),f=l(this,q).get(t),h=(100-.1)/2,c=(100+.1)/2,r=D(j(),l(this,E),D(j(),l(this,A),l(this,$)));for(const a of f){const u=new lt,d=[O(U(),Q(...o[a[0]],1),r),O(U(),Q(...o[a[1]],1),r),O(U(),Q(...o[a[2]],1),r)];for(const n of d)ct(n,n,1/n[3]);for(const n of d)n[0]=(1-n[0])*l(this,P)/2,n[1]=(1-n[1])*l(this,b)/2,n[2]=n[2]*h+c;for(let n=0;n<3;n++)u.setVertex(n,g(...d[n].slice(0,3)));u.setColor(0,255,0,0),u.setColor(1,0,255,0),u.setColor(2,0,0,255),M(this,H,et).call(this,u)}}}$=new WeakMap,A=new WeakMap,E=new WeakMap,B=new WeakMap,q=new WeakMap,I=new WeakMap,K=new WeakMap,P=new WeakMap,b=new WeakMap,k=new WeakMap,C=new WeakSet,T=function(e,t){const s=e[0],o=e[1],f=t[0],h=t[1],c=g(255,255,255);let r,a,u,d,n,p,x,v,S,W,N;if(u=f-s,d=h-o,n=Math.abs(u),p=Math.abs(d),x=2*p-n,v=2*n-p,p<=n){u>=0?(r=s,a=o,S=f):(r=f,a=h,S=s);const F=g(r,a,1);for(this.setPixel(F,c),N=0;r<S;N++){r++,x<0?x=x+2*p:(u<0&&d<0||u>0&&d>0?a++:a--,x=x+2*(p-n));const G=g(r,a,1);this.setPixel(G,c)}}else{d>=0?(r=s,a=o,W=h):(r=f,a=h,W=o);const F=g(r,a,1);for(this.setPixel(F,c),N=0;a<W;N++){a++,v<=0?v=v+2*n:(u<0&&d<0||u>0&&d>0?r++:r--,v=v+2*(n-p));const G=g(r,a,1);this.setPixel(G,c)}}},H=new WeakSet,et=function(e){M(this,C,T).call(this,e.a,e.b),M(this,C,T).call(this,e.b,e.c),M(this,C,T).call(this,e.c,e.a)},R=new WeakSet,st=function(e,t){return l(this,P)*Math.floor(l(this,b)-1-t)+Math.floor(e)},L=new WeakSet,X=function(){return _(this,k)._++};function z(i,e,t,s,o,f,h,c,r,a,u,d,n,p,x,v){return at(i,o,r,n,e,f,a,p,t,h,u,x,s,c,d,v)}const w=new ht,Z=document.querySelector("#canvas-el"),tt=Z.getContext("2d"),ot=Z.getAttribute("width"),it=Z.getAttribute("height");let V=0;function ft(i,e){e=e/180*Math.PI;let[t,s,o]=i;const f=Math.cos(e),h=Math.sin(e),c=1-f,r=Math.sqrt(t*t+s*s+o*o);return t/=r,s/=r,o/=r,new z(c*t*t+f,c*t*s-h*o,c*t*o+h*s,0,c*t*s+h*o,c*s*s+f,c*s*o-h*t,0,c*t*o-h*s,c*s*o+h*t,c*o*o+f,0,0,0,0,1)}function ut(i){let e=j();const t=new z(1,0,0,-i[0],0,1,0,-i[1],0,0,1,-i[2],0,0,0,1);return D(e,e,t),e}function dt(i,e,t,s){t=-t,s=-s;let o=j();const f=i/180/2*Math.PI,h=t*Math.tan(f),c=h*e,r=-c,a=-h,u=new z(t,0,0,0,0,t,0,0,0,0,t+s,-t*s,0,0,1,0),d=new z(2/(c-r),0,0,0,0,2/(h-a),0,0,0,0,2/(s-t),0,0,0,0,1),n=new z(1,0,0,-(r+c)/2,0,1,0,-(a+h)/2,0,0,1,-(t+s)/2,0,0,0,1),p=D(j(),d,n);return D(o,p,u),o}function Y(i=0){w.rasterizer(ot,it);const e=g(0,0,5),t=[g(2,0,-2),g(0,2,-2),g(-2,0,-2)],s=[g(0,1,2)],o=w.loadPositions(t),f=w.loadIndices(s);w.clear(!0,!0),w.setModel(ft(g(0,0,1),i)),w.setView(ut(e)),w.setProjection(dt(45,1,.1,50)),w.draw(o,f,"triangle"),mt(w.framebuffers)}function mt(i){const e=i.length,t=tt.createImageData(ot,it);for(var s=0;s<e;s++){var o=s*4;t.data[o]=i[s][0],t.data[o+1]=i[s][1],t.data[o+2]=i[s][2],t.data[o+3]=255}tt.putImageData(t,0,0)}window.addEventListener("keypress",function(i){i.code==="KeyA"&&(V--,Y(V)),i.code==="KeyD"&&(V++,Y(V))});Y(V);
